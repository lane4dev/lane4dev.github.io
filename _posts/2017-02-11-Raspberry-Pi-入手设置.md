---
layout: post
title: "Raspberry Pi 入手设置"
date: 2017-02-11 10:21:00 +0800
categories: Hardware
tags: [Raspberry Pi, Hardware]
comments: true
---

因为要做毕业设计，入手了一块树莓派 3B。下面简单记录一下我拿到板子之后做的基础配置流程。如果你也是刚刚拿到树莓派、还不知道从哪一步下手，可以按这篇文章的顺序来，差不多一盏茶的时间就能把环境折腾好。

---

## 一些简单的准备工作

正式开始之前，先确认一下手边大概有这些东西：

- 一块 Raspberry Pi（这里是 3B）
- 一张 **至少 16G** 的 micro SD 卡（建议 Class 10，读写会快一点）
- 一台可以上网的电脑（Windows / Linux 都可以）
- 一根网线（如果暂时不用 Wi-Fi，网线会简单很多）
- 一个读卡器（用来给 SD 卡写入系统镜像）

显示器、键盘、鼠标其实不是硬性要求，如果打算 **纯远程（headless）使用**，只要能通过 SSH 连上去，就可以不用给树莓派配独立显示器。

---

## 安装 Raspbian 系统

### 下载系统镜像

先到 [树莓派官网](https://www.raspberrypi.org/downloads/raspbian/) 下载 Raspbian 系统镜像。我选择的是带桌面的版本，也可以按实际需求选择：

- 只跑服务、当“小服务器”：可以用 Lite 版本，更精简；
- 想顺便当个小电脑用：可以选带桌面的版本。

下载好之后，就需要把镜像写入 SD 卡。

### 在 Linux 下写入镜像

在 Linux 环境下，可以用 `dd` 命令把镜像写入 SD 卡。假设你已经把镜像解压到了当前目录：

```bash
dd bs=4M if=2017-04-10-raspbian-jessie.img of=/dev/sdX
```

这里有几个关键点：

- `if`：输入文件（就是你下载的镜像）
- `of`：输出设备（你的 SD 卡），类似 `/dev/sdb`、`/dev/sdc` 这种
- `sdX` 对应的是 **整张 SD 卡**，而不是分区，比如 `/dev/sdb1` 这种带数字的分区名

要确定 `sdX` 具体是哪一个，可以用：

```bash
df -h
# 或
sudo fdisk -l
```

对照一下插拔 SD 卡前后的变化就能看出来了。

**请一定要反复确认 `of` 的目标设备，否则有可能把自己电脑的硬盘覆盖掉，那“毕业设计就是真的直接毙业”了。**

### 在 Windows 下写入镜像

如果你是 Windows 用户，就更简单一点，可以用 Win32DiskImager 这类图形化工具：

1. 打开 Win32DiskImager
2. 选择下载好的 `.img` 文件
3. 选择 SD 卡对应的盘符
4. 点击写入，等进度条走完

写完之后，安全弹出 SD 卡即可。

---

## 开启 SSH（强烈推荐提前做）

镜像写好后，把 SD 卡插回树莓派，接上电源，系统就能启动了。

不过在这之前建议多做一步——**先开启 SSH**。

Raspbian 默认是关闭 SSH 的，如果你没有显示器和键盘，就没法直接登录。

好在开启方式非常简单：

1. 把写好镜像的 SD 卡重新插回电脑
2. 系统会挂载一个叫 `/boot` 的分区
3. 在这个分区里，新建一个名为 `ssh` 的空白文件（没有扩展名）

完成之后再把 SD 卡插回树莓派、接通电源。系统启动时会检测到这个文件，然后自动开启 SSH 服务。
之后我们就可以愉快地在另一台电脑上远程登录树莓派了。

> **可选：顺便配置 Wi-Fi（headless 场景）**
> 如果你希望树莓派直接连 Wi-Fi，也可以在 `/boot` 里提前写一个 `wpa_supplicant.conf` 配置文件，让它开机自动连网，这里就不展开了，后期需要可以再专门写一篇。

---

## 连接与远程登录树莓派

### 获取树莓派的 IP 地址

树莓派接上网线并启动后，会从路由器获取一个 IP 地址（通过 DHCP）。

常见的几种获取方式：

- 在路由器管理页面里查看 DHCP 客户端列表，通常能看到一个名字类似 `raspberrypi` 的设备；
- 在 Linux 下可以用 `nmap` 扫描当前子网，例如：

  ```bash
  nmap -sn 192.168.1.0/24
  ```

  然后在扫描结果里找出树莓派的 IP；

- 某些系统下开启了 Bonjour/Avahi 服务，可以直接尝试访问 `raspberrypi.local`（不一定每个环境都生效，但可以一试）。

拿到树莓派的 IP 地址之后，就可以远程登录了。

### Windows 用户：使用 PuTTY

在 Windows 上，最常用的 SSH 工具就是 PuTTY：

1. 打开 PuTTY
2. 在 Host Name 中填入树莓派的 IP（例如：`192.168.1.100`）
3. 保持默认端口 22，点击「Open」
4. 出现命令行窗口后，输入：

```text
username: pi
password: raspberry
```

登录成功之后，就已经进入树莓派的系统了。

### Linux 用户：直接用终端

在 Linux（或 macOS）下就更直接了：

```bash
ssh pi@[IP Address]
# 例如
ssh pi@192.168.1.100
```

第一次连接时会提示确认主机指纹，输入 `yes`；
然后输入默认密码 `raspberry`，就可以登录了。

> 建议登录成功之后尽快修改默认密码。

---

## 使用 `raspi-config` 做基础配置

连上树莓派之后，先把一些基础设置做一做。官方提供了一个配置工具，用起来比较省心：

```bash
sudo raspi-config
```

在这个界面里，可以完成很多常见操作，例如：

- 修改默认密码（**必做**）
- 设置时区（保证日志时间和现实一致）
- 设置语言和键盘布局
- 扩展根分区到整张 SD 卡（否则有时只会用到一部分空间）
- 开启/关闭一些接口：如 SSH、SPI、I2C、Camera 等

整个配置是菜单式的，用方向键和回车就能操作，按照提示一步一步来，不会太难。

如果是做毕业设计或者打算长期远程使用，建议至少做完：

1. 改密码
2. 设置正确的地区 / 时区 / 语言
3. 确认 SSH 已启用
4. 视项目需求开启相应接口（比如要用摄像头、I2C 传感器等）

---

## 更新系统和软件包

新系统装好之后，升级一下是个好习惯。既能修复旧版本的 bug，也能让软件版本跟上来。

先更新软件包列表：

```bash
sudo apt-get update
```

这个命令不会真正安装任何东西，只是让系统知道「有什么软件可以更新」。

然后执行升级：

```bash
sudo apt-get dist-upgrade
```

这一步会根据需要更新系统和已安装的软件包，时间长短取决于镜像版本和网络情况。
如果你只是想做比较保守的升级，也可以用：

```bash
sudo apt-get upgrade
```

无论用哪一种，建议在刚配置完树莓派时跑一次，后面就可以按需要定期更新。只要电源不断，这块小板子能陪你做不少有意思的事情。😄
