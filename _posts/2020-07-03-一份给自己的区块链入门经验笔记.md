---
layout: post
title: "一份给自己的区块链入门经验笔记"
date: 2020-07-03 18:14:00 +0800
categories: Notes
tags: [Blockchain]
comments: true
---

如果你第一次听到“区块链”，脑子里蹦出来的只有 “比特币” “挖矿” “一夜暴富”，那这篇小记正好写给现在的你，也写给未来可能要跟别人吹逼的自己。这里不聊花哨的概念，只从一件最朴素的小事讲起：在没有银行、没有平台、彼此又不信任的情况下，人们是怎么在互联网上“记账”的？

## 先从我们熟悉的转账说起

我最开始理解区块链，是从一个朴素的问题出发的：

> 网上转账这件事，本质上是在干嘛？

在传统模式里（银行 App、微信、支付宝），流程大概是这样：

- 你把“我要给某人转多少钱”的请求发给一个 **可信第三方**（银行 / 支付机构）。
- 第三方有一份 **中心化账本**：谁有多少钱、转给谁、什么时候转。
- 只要我们相信“这个机构不会乱记账”，事情就算稳了。

整个系统运转的前提只有一个：
**有一个大家都信任的“中心”在给所有人记账。**

---

## 去中心化的思路：大家都不信任彼此，那账要怎么算？

比特币白皮书的副标题是：

> A Peer-to-Peer Electronic Cash System（点对点电子现金系统）

翻译成人话就是：
**我们能不能在没有银行、没有平台的前提下，在互联网上直接给对方转钱？**

问题马上出现：

- 互联网上的陌生人 **互相不信任**。
- 又不想找一个“管家”来记账。
- 还要防止各种作弊：假币、重复花钱（double spending）等问题。

而比特币的解决方案是：

1. **每一笔转账都广播** 到整个网络。
2. 所有人用 **数字签名** 验证 **你是不是这笔钱真正的拥有者**。
3. 网络中的节点会把这些交易打包，形成一个个 **区块（block）**。
4. 这些区块按时间顺序 **串起来**，变成一条链：
   这就是 **区块链（blockchain）**，一个公开的、分布式的、按时间排序的交易总账。

换句话说：

传统世界是 **一个中心记账**；
区块链世界是 **所有人各自记账，但想办法达成统一版本**。

有句经常被提起的话其实挺有道理：

> 账本的可靠性，是数字货币的基石。

---

## 共识机制：大家都在记账，怎么选一个“官方版本”？

如果 **每个人都可以记账**，马上就有几个新坑：

- A 记的账本和 B 不一样。
- 同一笔转账，顺序不同、是否存在都可能不同。
- 有人干脆记假账：给自己平空加几笔钱。

所以区块链必须回答一个问题：

在一个没有“老大”的网络里，
我们如何选出一个 **大家都承认的账本**？

这套选账规则，就叫作 **共识机制（Consensus Mechanism）**。
它解决的是：**在去中心化网络中，怎么统一哪条链才是对的？**。

### 谁来记账？

以比特币为例，它采用的是最经典的一种：**工作量证明（Proof of Work, PoW）**。

大致规则是：

1. 网络中有一群节点叫 **矿工**，负责打包交易、生成新区块。

2. 想拿到“记账权”，大家要参加一个 **算力竞赛**：
出一道“只能靠不断试错”才能解出的难题（本质上是不断尝试随机数，让区块头哈希结果满足 **前面若干位都是 0** 之类的条件）。
谁先算出满足条件的哈希值，谁赢。

3. 赢的人：
得到一次 **记账权**：可以把自己打包的交易记录成新区块。
再顺带领取一份系统奖励（区块奖励 + 手续费），这就是我们常说的 **挖矿收益**。

这种“做题争记账权”的方式，就是 **工作量证明**。它有几个特点：

- **过程很难**：要花大量算力反复试。
- **验证很容易**：算出来之后，别人一眼就能通过哈希检查你是不是在瞎说。
- 任何人只要有设备，都可以参与，是一种 **开放式记账权限竞争**。

### 怎么保证账本不被造假？

PoW 带来两个重要效果：

1. **篡改历史特别贵**
想修改某个历史区块里的交易，你必须重算这个区块之后的所有区块的 PoW。
还要在算力上超过全网其他诚实节点，才能让别人接受你的伪造链。

2. **绝大多数人诚实时，坏人很难得手**
如果攻击者没有超过全网 50% 的算力，他出的一条“作弊链”一般追不上诚实节点出的那条正儿八经的链。
按**最长链原则**，大家只承认最长的那条链，攻击就会失败。

这里就引出了一个著名的概念：**51% 攻击**。

如果有人掌握了全网超过 50% 的算力，
他在理论上就可以重写近期的一部分账本，比如双花（同一笔数字货币，被同一个人“花”了两次或多次）、撤销自己的转账等。

现实里，要对比特币级别的网络发动这种攻击，硬件和电费成本都极其夸张，所以通常只会在一些小币种身上看到成功案例。

---

## 区块和区块头：账本是怎么“一块块”堆起来的？

如果把区块链看成一本超级长的流水账，那：

- 每一页，就是一个 **区块（Block）**；
- 每一页的页眉，就是 **区块头（Block Header）**；
- 页和页之间，用一种叫 **哈希指针（hash pointer）** 的方式串联起来：
  每个区块头里，都放着 **上一个区块的哈希值**。

这样一来，只要你改了历史某一页，
这一页的哈希就变了,
下一页里存的“上一页哈希”立刻对不上,
后面的所有页都跟着失效，想修复就得全链重算 PoW。

这就是**篡改代价高**的根本原因。

典型的一个区块，大概包含：

- **区块头**：

  - 上一个区块的哈希（把它们串成链）；
  - 时间戳；
  - 难度目标；
  - 随机数（Nonce，矿工不断调整的那串数字）；
  - 当前区块中所有交易的 Merkle 根等信息。

- **交易列表**：

  - 一堆已经验证通过、准备写进历史的交易。

简单点说：
**区块 =（一堆交易）+（把这些交易的“压缩指纹”和上一个区块绑在一起的区块头）**。

---

## 抢记账的游戏：挖矿到底在干嘛？

从工程视角看，“挖矿”这两个字有点误导，它其实做的是：

1. 从内存池里挑选交易（一般优先选择手续费高的）；

2. 组装一个候选区块；

3. 不断修改区块头中的随机数，反复计算哈希，
直到找到一个“够小”的哈希，比如前 n 位都是 0；

4. 把这个“解出来的区块”广播给全网；

5. 如果多数节点验证无误，就会：
接受这个区块，把它接在当前最长链之后，给你发奖励（新发行的币 + 手续费）。

这样做有几个很实在的优点：

- **算出来难，检查起来容易**：验证区块的成本远远低于挖出区块的成本。
- **开放参与**：理论上任何人都能当矿工（现实中逐渐被大规模矿场主导，那是另一层故事）。
- **安全性与成本挂钩**：你想攻击系统，就得砸真金白银去堆算力。

---

## 分叉、最长链和“听谁的”问题

网络是分布式的，消息传播不会同步。
于是一个常见场景是：
两个矿工几乎同时挖出两个不同的区块，
各自挂在当前链的末尾。

这就出现了**短暂分叉**：链一分为二，两条都看起来合法。

Nakamoto 的设计是：

**所有矿工只在自己看到的“最长链”上继续挖**。
随着新块不断被接上，其中一条链会更长。
网络最终自然会选边站，只保留最长的那条。
另一条比较短的链上的区块就变成了**孤块 / 过期块**，里面的交易会回到内存池，等待再次打包。

经验上的理解是：

只要等后面多确认几个区块（例如比特币常说的 6 个），
你这笔交易被回滚的风险就会迅速变得非常低。

---

## “钱包”到底是什么？钱放哪了？

刚接触时我也以为“钱包”就是存币的地方，后来才意识到：

你的币**始终在链上**，
钱包只是一套**管理钥匙的工具**。

典型的钱包会帮你生成一对密钥：

- **私钥（Private Key）**：
可以理解成一串只有你知道的超级密码。
你用它对交易“签名”，证明“这笔钱确实是我花的”。
一旦丢了或泄露了，等同于把钱交给别人，系统不会帮你追回。

- **公钥 / 地址（Public Key / Address）**：
可以公开给任何人。
别人往这个地址转账，你就能用私钥把钱花出去。
类比：银行卡号可以给别人，取款密码绝不能给。

所以：
“自己保管私钥”的钱包叫 **非托管钱包**。
把币放在交易所里，由平台替你保管私钥，就是 **托管钱包**，法律和安全风险都不一样。

从安全经验上看，尤其值得自己记住的只有一句话：
**你不是“拥有币”，你是“拥有能动这些币的私钥”。**

---

## 8. 关键点

用提问题的方式再梳理一遍，上面提到的关键点：

- 传统在线交易怎么完成？

  - 依赖可信第三方（银行 / 支付机构）维护中心化账本。

- 去中心化交易怎么完成？

  - 交易广播 + 数字签名 + 所有节点共享的分布式账本。

- “数字货币的基石”是什么？

  - 可被所有人验证、**几乎不可篡改**的公共账本。

- 什么是共识机制？解决什么问题？

  - 在没有中心的网络里，统一 “哪条链才是对的”。

- 谁来给大家记账？

  - 挖矿节点，通过 PoW 争夺记账权。

- 账本怎么防造假？

  - PoW + 哈希链结构，让篡改历史的成本极高。

- 区块和区块头是什么？

  - 区块：一堆交易 + 区块头；
  - 区块头：指向上一个区块的哈希 + 时间戳 + 难度 + Nonce + Merkle 根等。

- 挖矿在干嘛？

  - 打包交易、解 PoW 难题、争取记账权和奖励。

- 两个人同时打包出区块听谁的？

  - 按最长链原则，最终网络收敛到最长的那条。

- 什么是 51% 攻击？

  - 某一方掌握超过 50% 算力，可以在一定范围内重写账本、双花。

- 区块链钱包是什么？

  - 管理私钥 / 公钥 / 地址的钱包软件或硬件，本质是 “钥匙管理器”，不是钱真正存放的位置。
