---
layout: post
title: "Rezoning 系统拆解"
date: 2025-06-01 00:00:00 +0800
categories: Code
tags: ["Python", "Notes"]
comments: true
---

Rezoning 本质上是一个把「全球多源空间数据 + 经济模型」拼在一起，
用来做风光项目宏观选址和情景对比的决策支持工具。

它不是帮你画最后一排机位、调整单条电缆的“细活”，
而是站在国家或省级尺度上，回答几个更基础的问题：
**哪些区域可以建？大致能建多少？大概多少钱一度电？和别的区域相比划算吗？**

下面就从数据、限制性分析（siting constraints）、财务与 LCOE 模型三个角度，宏观拆解一下这个系统。


## 数据

Rezoning 背后的数据可以粗略分成四大类：

### 资源与气象：CF 和基础气候栅格

**核心是容量系数（Capacity Factor, CF）栅格和相关资源数据。**

- **风资源**：
  来自 Global Wind Atlas（GWA）的多高度风速/风功率栅格（10m/50m/100m/150m/200m），
  再通过不同机型的功率曲线，预计算为各类机型的 CF 栅格，如 `gwa-iec1`、`gwa-vestas-v136-mode0-150` 等。

- **光伏资源**：
  来自 Global Solar Atlas（GSA）的 PVOUT（光伏发电潜力）、GHI/GTI/温度等栅格，
  例如 `gsa-pvout`、`gsa-ghi`、`gsa-gti`、`gsa-temp`。

这些数据都被重采样到统一的约 500 m 分辨率（TIFF），为后续所有约束和经济计算提供空间底板。

### 地形、环境和用地

第二层是描述**这块地长什么样**的自然与环境约束，例如：

- **地形**：

  - `srtm90` 高程
  - `slope` 坡度

- **土地利用 / 覆盖**：`land-cover`（耕地、草地、城市、湿地、冰雪等类别）
- **水体与海洋**：`waterbodies`、`gebco`（水深）、沿海潮间带 `unep-tidal`、湿地 `wwf-glw-3`
- **环境保护**：`pp-whs`、`pp-marine-protected`、Ramsar 湿地、珊瑚礁 `unep-coral` 等
- **文化保护**：`unesco`（世界文化遗产—距离栅格）

这些栅格和要素构成了**生态红线+不宜开发区**的空间显式表达。
Rezoning 的限制性分析就是在这些层上做布尔筛选和距离约束。

### 接入电网与建设条件

第三层主要是**接得上电、修得进路、人够不够**这类偏工程和社会条件：

- **电网与路网**：高压输电线路 `grid`、道路 `roads`（以距离栅格形式参与分析）
- **交通设施**：机场 `airports`、港口 `ports`、锚地 `anchorages`
- **人口分布**：`worldpop`（人口密度），反映负荷中心与潜在社会敏感性

这些原本是矢量（线、点），在后台被转成**距最近要素的距离栅格**（单位 m），
再通过过滤器设置“不能离太远/不能太近”，形成可建区域的工程可达性约束。

### 技术经济参数

Rezoning 还加载了一套**非空间的技术经济参数**：

- 来自 IRENA 的**单位投资（CAPEX）与固定运维成本**按技术类型给出，如：

  - 光伏 CAPEX ≈ 794 USD/kW，固定 O&M ≈ 9.5 USD/kW/年
  - 陆上风电 CAPEX ≈ 1222 USD/kW，固定 O&M ≈ 37 USD/kW/年

- 用户可调的**折现率、项目寿命、技术损耗率、不可利用率、可变 O&M、电网和道路单位造价、拆除成本**等。

- **每国默认范围 JSON**：如 `/filter/CHN/solar/layers` 中给出各层的 `min/max`，既用来缩放权重计算，也为 UI 提供合理的默认过滤区间。

这些参数决定了每个 500 m 栅格上**建一度电要花多少钱**的结果，是从空间分析走向经济可行性评估的桥梁。


## 限制性分析

Rezoning 的第一步不是算 LCOE，而是回答一个更基础的问题：
在一个国家或海域里，**哪些格网是“潜在可建”的，哪些必须一票否决？**

这就是所谓的**限制性分析（constraints / exclusion analysis）**。

### Filter 抽象

`filter` schema 的源代码很清晰地反映了它的抽象方式：

- **数值型范围过滤（range_filter）**
  如：坡度 0–5%、海深 0 到 -50 m、距输电线路 0–100 km、风速 ≥ 7 m/s。

- **分类过滤（categorical_filter）**
  如：土地覆被只保留若干类型（耕地、草地、城市、裸地、部分湿地等）。

- **布尔开关（boolean）**
  如：是否排除自然保护区、湿地、水体等。

对用户来说只是在面板上拖动滑块、勾选多选框；
对后台来说，这些操作都被翻译成对对应栅格的阈值重分类（reclass）和 AND 叠加。

### 典型的多层逻辑

以**中国陆上风电**为例，可以抽象出大致三层约束：

1. **资源与物理约束**

   - `Wind Speed at 100m ≥ 7 m/s` → 过滤掉低风速区域
   - `Elevation 0–3000 m`、`Slope 0–20%` → 排除过高、过陡区域，兼顾工程可行性和成本

2. **环境与用地约束**

   - Land Cover 仅允许一部分类型（耕地、草地、稀疏植被、部分城市等）
   - Protected Areas / Ramsar / Wetlands / 水体：通常作为布尔排除

3. **工程与人类活动约束**

   - `Distance to Grid 0–20 km`：太远会推高接网成本
   - `Distance to Roads 0–10 km`：保证施工和运维可达
   - `Distance to Airports ≥ 55 km`：通过安全净空限制风机离机场一定距离

光伏和海上风电的逻辑类似，只是换成 PVOUT 或水深等不同的关键指标。
海上风电则使用 EEZ（专属经济区）边界 + 水深范围 + 距港口/锚地的距离阈值来刻画“靠海又不太深、靠近港口”的区域。

### 空间计算流程（宏观视角）

可以用一句话概括后台流程：

**把所有相关的栅格按国家边界裁剪 → 按 Filter 变成 0/1 掩膜 → 对每个 500 m 像元做逻辑 AND → 得到“适宜开发”掩膜。**

这里的“0/1 掩膜”就是**这块格子在当前场景下是否符合所有硬约束**的答案。之后所有经济计算和评分，都是仅在这些掩膜内的像元上进行。


## 财务与 LCOE 模型

在得到“可建 vs 不可建”的空间格局之后，Rezoning 下一步要做的是**把每一个可建格子的经济性算出来**。核心指标就是**平准化度电成本（LCOE）**。

### 用到哪些经济数据？

结合源代码分析，主要有三类输入：

1. **与位置无关（全局或全国统一）的参数**

   - 单位装机投资成本 `cg`（USD/kW）
   - 固定 O&M `omfg`（USD/kW/年）
   - 可变 O&M `omvg`（USD/MWh）
   - 折现率 `i`、项目寿命 `n`、技术损耗 `tlf`、不可利用率 `af`
     这些大多来自 IRENA 的技术成本数据库，或由用户做情景假设。

2. **与位置强相关的空间变量**

   - **容量系数 CF 栅格**：由资源数据 + 机组/组件类型决定
   - **距电网距离 DS**：由 `grid` 线数据生成
   - **距道路距离 DR**：由 `roads` 生成
   - 海上风电还会用到水深等，用来间接反映基础形式和成本差异。

3. **技术/布局参数**

   - `landuse`：单位面积装机密度（MW/km²）
   - `decom`：退役成本系数
   - `cs`：变电站成本、`ct`：每 MW 每 km 的电缆成本、`cr`：道路造价等。

### LCOE 模型结构：拆成三块账来算

从公式和 NREL 的标准 LCOE 定义来看，Rezoning 的思路是典型的**年化成本 / 年发电量**，只不过把成本拆解得更细：

1. **先用资本回收因子（CRF）把 CAPEX 年化**

   根据折现率 `i` 和寿命 `n` 计算一个 CRF，把一次性投资摊到每一年；

   年化后的“年投资成本 + 固定 O&M”再除以年发电量，得到**发电侧 LCOE_GENERATION**。

2. **电网接入成本 LCOE_INTERCONNECTION**

   假设每个格网的接网距离根据 `Distance to Grid`（DS）估算线路长度和造价；

   将“线路 CAPEX + 固定 O&M + 变电站 CAPEX”按同样方法年化，再除以年发电量；

   这样距离电网更远的格子，LCOE_INTERCONNECTION 自然更高。

3. **道路与场内交通成本 LCOE_ROAD**

   使用 `Distance to Roads`（DR）估算需要新修道路的长度；

   道路 CAPEX + O&M 同样年化，再按假定的“每 50 MW 配一条路”分摊到单位电量。

最后三块加总得到单元格的 **LCOE_TOTAL = LCOE_GENERATION + LCOE_INTERCONNECTION + LCOE_ROAD**，并做上限截断（避免极端值影响可视化）。

**关键点在于：CF、DS、DR 都是栅格化的，因此 LCOE 本身也是一个 500 m 分辨率的空间栅格。** 这就把“局部风好/光好、离网近不近”这些差异，直接投射到 LCOE 数值上。

### 容量系数的修正

Rezoning 使用公式 $SEL_{CF} = CF \times (1 - lf) \times (1 - af)$ 进行容量系数修正：

- 原始 CF 来自风/光资源模型与机组性能；
- 再按技术损耗（变流器、线路、电气损失等）和设备不可用率（检修、故障）做一次统筹下调；
- 光伏还对日度 PVOUT 做“日 → 小时”的转换，并反推内置损耗，以保证和用户输入的损耗假设一致。

这样得到的 CF 更接近**项目生命周期内的有效利用小时**，可直接用于年发电量和 LCOE 计算。


## 适宜性评分与分区

把“多指标”压成一个可以排序的分数，在有了：

- 可开发掩膜（0/1 栅格）
- LCOE 栅格
- 其它一系列空间指标（距电网、距道路、人口密度等）

之后，Rezoning 还构建了一个**综合评分模型（Score）**，用来做多目标排序和分区对比。

### 加权评分

通过这些公式，本质上就是一个**标准化 + 加权平均**的多指标适宜性分析：

1. 对每个指标（比如 LCOE、距电网、人口密度、坡度等）做**归一化/缩放**，得到 `SCALED_ARRAY`；
2. 用户在前端设置或接受默认的权重（如 LCOE Generation 50%，距电网 50%）；
3. 对每个格子做

   $$
   \text{Score} = \dfrac{\sum (\text{weight} \times \text{scaled_value})}{\sum \text{weight}}
   $$

这样在掩膜内的每个 500 m 格子就都有一个 0–1 或 0–100 的综合得分，数值越高代表在当前情景下越“值得优先开发”。

从 Rezoning 用户指南看，这套多指标加权框架是应用在 solar / onshore wind / offshore wind 三类技术上的通用方法，
只是默认权重和可选指标略有不同。

### Zone 接口

Score 解决的是“每个像元好不好”；但真正决策时更关心的是：
某一个规划区块（Zone）整体表现怎样？能建多少？大约多少钱一度电？

`/zone` 接口就是把**像元级信息汇总到多边形区块**上，输出比如：

- `lcoe`：区域内 LCOE 栅格的平均值；
- `zone_score`：区域内综合得分的平均值；
- `suitable_area`：在当前 Filter 下，该区块的可开发面积；
- `icp`：按单位面积装机系数折算的潜在装机容量（MW）；
- `generation_potential`：乘以区域平均 CF 和 8760 小时，得到年发电量（GWh）；
- `cf`：区域内 CF 的平均值。

这一整套输出与工具对**帮助政府和规划者评估不同区域的可再生能源潜力和经济性**的定位高度吻合。


## 五、宏观视角下 Rezoning 的意义

站在宏观的角度看，Rezoning 做的事情可以概括为一条连续的链条：

1. **数据标准化与集成**
   把全球风光资源（GWA/GSA）、地形、土地利用、保护地、电网、公路、人口以及 IRENA 成本曲线等，统一到同一套坐标系、分辨率和接口之下。

2. **限制性分析（Can we build?）**
   用 Filter 系统，把法规红线、物理约束、工程约束数值化，得到“可建掩膜”。

3. **技术经济分析（How much does it cost?）**
   用 LCOE 模型把 CAPEX、O&M、折现率和空间上的 CF/距网/距路等因素叠加起来，得到每个格子的“度电成本地图”。

4. **多指标综合与分区评价（Where is best?）**
   通过加权评分和区域汇总，在国家、流域或自定义 AOI（感兴趣区域）尺度上，对不同候选区块做可比性很强的排序与对比。

对政策制定者、开发商、咨询机构来说，Rezoning 的价值不在于替代详勘和可研，而在于：

1. 快速做**全国/区域级的技术路线与区域布局比较**（比如光伏 vs 风电、陆上 vs 海上）；
2. 在统一的数据和方法框架下，对不同情景（成本下降、折现率变化、环境约束收紧等）进行**高效的敏感性分析**；
3. 为后续更细致的选址、测风/测光和电网规划提供一个**先筛一遍的候选区清单**，大幅降低前期摸黑搜地的成本。

最后用一句话总结：

Rezoning 把原本散落在不同平台上的全球风光资源、环境约束和技术经济参数，
整合成了一套 **数据 → 限制性 → 经济性 → 评分与分区** 的流水线，
帮你在地图上直观看到：**在哪儿能建、能建多少、值不值得建。**
