{%- include functions.html func='log' level='debug' msg='Get banner_html value' -%}
{% assign name = 'banner_html' %}
{%- include functions.html func='get_value' -%}
{% assign banner_html = return %}

{%- include functions.html func='log' level='debug' msg='Get heading value' -%}
{% assign name = 'heading' %}
{%- include functions.html func='get_value' -%}
{% assign heading = return %}

{%- include functions.html func='log' level='debug' msg='Get subheading value' -%}
{% assign name = 'subheading' %}
{%- include functions.html func='get_value' -%}
{% assign subheading = return %}

{%- include functions.html func='get_banner' -%}

{%- if has_banner -%}
  {%- if banner_background -%}
  <style>
    html .page-banner {
      background: {{ banner_background }};
    }
  </style>
  {%- endif -%}
  {%- if banner_height -%}
  <style>
    {%- assign num = banner_height | times: 1 -%}
    {%- assign unit = banner_height | replace_first: num -%}
    {%- assign banner_min_height = banner_min_height | default: banner_height -%}
    html .page-banner {
      height:  {{ banner_height | times: 0.368 | append: unit }};
      min-height: {{ banner_min_height }};
    }
    html[data-scroll-status="top"] .page-banner {
      height: {{ banner_height }};
    }
  </style>
  {%- endif -%}

  {%- if banner_opacity -%}
  <style>
    html .page-banner .page-banner-img > *:first-child {
      opacity: {{ banner_opacity }};
    }

    html[data-theme="dark"] .page-banner .page-banner-img > *:first-child {
      opacity: {{ banner_opacity | times: 0.718 }};
    }
  </style>
  {%- endif -%}
  {%- if banner_heading_style -%}
  <style>
    html .page-banner .page-banner-inner > *:first-child > *:nth-child(1) {
      {{ banner_heading_style }}
    }
  </style>
  {%- endif -%}
  {%- if banner_subheading_style -%}
  <style>
    html .page-banner .page-banner-inner > *:first-child > *:nth-child(2) {
      {{ banner_subheading_style }}
    }
  </style>
  {%- endif -%}
  <section class="page-banner">
    <div class="page-banner-img">
      {%- if banner_video -%}
        <video
          autoplay=""
          poster="{{ banner_image }}"
          playsinline
        >
          <source src="{{ banner_video }}">
        </video>
        <script>
          (function() {
            var video = document.querySelector('.page-banner .page-banner-img > video');
            var videoPlay = function() {
              video.play().catch (function() {
                  video.muted = true;
                  video.play();
                });
            }

            video.onloadstart = function() {
              video.currentTime = {{ banner_start_at }};
              video.volume = {{ banner_volume }};
              video.muted = (video.volume == 0);
              videoPlay();
            }

            video.onended = function() {
              video.currentTime = {{ banner_start_at }};
              video.volume = 0;
            {%- if banner_loop -%}
              video.play();
            {%- endif -%}
            }
          })();
        </script>
      {%- else -%}
        {%- if page.vanta_effect -%}
          <div id="vanta-canvas" style="width: 100%; height: 100%; background: #23153c;"></div>
          <!-- Load Three.js -->
          <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
          <!-- Load Vanta Effect -->
          <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.{{ page.vanta_effect }}.min.js"></script>
          <script>
            document.addEventListener('DOMContentLoaded', function() {
              var effectName = "{{ page.vanta_effect | upcase }}";
              var config = {
                el: "#vanta-canvas",
                mouseControls: true,
                touchControls: true,
                gyroControls: false,
                minHeight: 200.00,
                minWidth: 200.00,
                scale: 1.00,
                scaleMobile: 1.00
              };
              
              // Custom configurations based on effect type
              if (effectName === 'GLOBE') {
                config.color = 0xff2d92;
                config.color2 = 0xffffff;
                config.backgroundColor = 0x23153c;
                config.size = 1.0;
              } else if (effectName === 'NET') {
                config.color = 0xff2d92;
                config.backgroundColor = 0x23153c;
                config.points = 10.0;
              } else {
                // Default colors for other effects
                config.color = 0xff2d92;
                config.backgroundColor = 0x23153c;
              }

              if (window.VANTA && window.VANTA[effectName]) {
                window.VANTA[effectName](config);
              }
            });
          </script>
        {%- else -%}
          <div style="background-image: url({{ banner_image }})"></div>
          <img class="img-placeholder" src="{{ banner_image }}">
        {%- endif -%}
      {%- endif -%}
    </div>
    <div class="wrapper">
      <div class="page-banner-inner">

        {%- if banner_html -%}

        {%- assign banner_html = 'views/' | append: banner_html -%}
        {%- include {{ banner_html }} -%}

        {%- else -%}

          <div class="page-banner-default">
            <h1 class="page-banner-heading">
              {%- if page.typing_effect -%}
                <span id="typed-heading"></span>
              {%- else -%}
                {{ heading | default: page.title | escape }}
              {%- endif -%}
            </h1>
            <h2 class="page-banner-subheading">
              {%- if page.typing_effect -%}
                <span id="typed-subheading"></span>
              {%- else -%}
                {{ subheading | default: page.subtitle | escape }}
              {%- endif -%}
            </h2>
          </div>

          {%- if page.typing_effect -%}
          <script src="https://unpkg.com/typed.js@2.0.16/dist/typed.umd.js"></script>
          <script>
            document.addEventListener('DOMContentLoaded', function() {
              var headingText = {{ heading | default: page.title | jsonify }};
              var subheadingText = {{ subheading | default: page.subtitle | jsonify }};
              
              new Typed('#typed-heading', {
                strings: [headingText],
                typeSpeed: 90,
                showCursor: true,
                cursorChar: '|',
                onComplete: function(self) {
                  self.cursor.remove(); // Remove cursor from heading when done
                  
                  // Start subheading typing
                  new Typed('#typed-subheading', {
                    strings: [subheadingText],
                    typeSpeed: 60,
                    startDelay: 500,
                    showCursor: true,
                    cursorChar: '|'
                  });
                }
              });
            });
          </script>
          {%- endif -%}

        {%- endif -%}
      </div>
    </div>
    {%- if page.show_scroll_down -%}
    <div class="scroll-down-btn" onclick="document.querySelector('.page-content').scrollIntoView({ behavior: 'smooth' });">
      <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
      </svg>
    </div>
    {%- endif -%}
  </section>
{%- endif -%}
